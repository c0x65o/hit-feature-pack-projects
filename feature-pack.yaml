# Feature Pack: projects
# Domain-agnostic Projects feature pack - execution containers with teams, activity types, links, and activity log

name: projects
description: Projects feature pack - execution containers with teams, activity types, links, and activity log

# ─────────────────────────────────────────────────────────────────────────────
# ROUTES - Frontend page routes
# ─────────────────────────────────────────────────────────────────────────────
routes:
  - path: /projects
    page: Dashboard
    roles: []
  - path: /projects/new
    page: CreateProject
    roles: []
  - path: /projects/[id]
    page: ProjectDetail
    roles: []
  - path: /projects/[id]/edit
    page: EditProject
    roles: []
  - path: /projects/timeline
    page: Timeline
    roles: []
  - path: /projects/setup/statuses
    page: ProjectStatusesSetup
    roles: [admin]
  - path: /projects/setup/statuses/new
    page: CreateProjectStatus
    roles: [admin]
  - path: /projects/setup/statuses/[id]
    page: EditProjectStatus
    roles: [admin]
  - path: /projects/setup/activity-types
    page: ProjectActivityTypesSetup
    roles: [admin]
  - path: /projects/setup/activity-types/new
    page: CreateProjectActivityType
    roles: [admin]
  - path: /projects/setup/activity-types/[id]
    page: EditProjectActivityType
    roles: [admin]

# ─────────────────────────────────────────────────────────────────────────────
# NAVIGATION - Sidebar/topbar items
# ─────────────────────────────────────────────────────────────────────────────
nav:
  - id: projects
    label: Projects
    path: /projects
    icon: FolderKanban
    group: main
    weight: 100
    showWhen: authenticated
    children:
      - id: projects-dashboards
        label: Dashboard
        path: /dashboards?pack=projects
        icon: LayoutDashboard
        weight: 0
        showWhen: authenticated
      - id: projects-dashboard
        label: Projects
        path: /projects
        icon: FolderKanban
        weight: 100
        showWhen: authenticated
      - id: projects-timeline
        label: Timeline
        path: /projects/timeline
        icon: Clock
        weight: 200
        showWhen: authenticated
      - id: projects-setup
        label: Setup
        path: ""
        icon: Settings
        weight: 900
        showWhen: authenticated
        roles: [admin]
        children:
          - id: projects-setup-statuses
            label: Statuses
            path: /projects/setup/statuses
            icon: Tag
            weight: 100
            showWhen: authenticated
            roles: [admin]
          - id: projects-setup-activity-types
            label: Activity Types
            path: /projects/setup/activity-types
            icon: List
            weight: 200
            showWhen: authenticated
            roles: [admin]

# ─────────────────────────────────────────────────────────────────────────────
# SCHEMA - Drizzle ORM table definitions
# ─────────────────────────────────────────────────────────────────────────────
schema:
  source: src/schema/projects.ts
  exports:
    - projects
    - projectStatuses
    - projectActivityTypes
    - projectLinks
    - projectActivity
    - projectNotes
    - Project
    - ProjectStatusRecord
    - ProjectActivityType
    - ProjectLink
    - ProjectActivity
    - ProjectNote
    - InsertProject
    - InsertProjectStatus
    - InsertProjectActivityType
    - InsertProjectLink
    - InsertProjectActivity
    - InsertProjectNote
    - DEFAULT_PROJECT_STATUS_LABELS
    - SYSTEM_ACTIVITY_TYPES
    - ProjectStatus
    - DefaultProjectStatusLabel
    - SystemActivityType

# ─────────────────────────────────────────────────────────────────────────────
# API ROUTES - Backend endpoints
# ─────────────────────────────────────────────────────────────────────────────
api:
  routes:
    # Projects
    - path: /api/projects
      methods: [GET, POST]
      handler: "@hit/feature-pack-projects/server/api/projects"
      description: "List projects (GET) or create project (POST)"
    - path: /api/projects/[projectId]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-projects/server/api/projects-id"
      description: "Get, update, or delete a specific project"
    # Project Activity Types (setup-controlled)
    - path: /api/projects/activity-types
      methods: [GET, POST]
      handler: "@hit/feature-pack-projects/server/api/projects-activity-types"
      description: "List activity types (GET) or create activity type (POST) [admin]"
    - path: /api/projects/activity-types/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-projects/server/api/projects-activity-types-id"
      description: "Get, update, or delete an activity type [admin]"
    # Project Links
    - path: /api/projects/[projectId]/links
      methods: [GET, POST]
      handler: "@hit/feature-pack-projects/server/api/projects-links"
      description: "List project links (GET) or create link (POST)"
    - path: /api/projects/[projectId]/links/[linkId]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-projects/server/api/projects-links-id"
      description: "Get, update, or remove a project link"
    # Project Activity
    - path: /api/projects/[projectId]/activity
      methods: [GET, POST]
      handler: "@hit/feature-pack-projects/server/api/projects-activity"
      description: "List project activity log (GET) or create activity (POST)"
    - path: /api/projects/[projectId]/activity/[activityId]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-projects/server/api/projects-activity-id"
      description: "Get, update, or delete a specific project activity"
    - path: /api/projects/activity/all
      methods: [GET]
      handler: "@hit/feature-pack-projects/server/api/projects-activity-all"
      description: "List all activities across all projects (for timeline view)"
    # Project Statuses (setup-controlled)
    - path: /api/projects/statuses
      methods: [GET, POST]
      handler: "@hit/feature-pack-projects/server/api/projects-statuses"
      description: "List project statuses (GET) or create status (POST) [admin]"
    - path: /api/projects/statuses/[statusKey]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-projects/server/api/projects-statuses-key"
      description: "Get, update, or delete a project status [admin]"

# ─────────────────────────────────────────────────────────────────────────────
# DEPENDENCIES
# ─────────────────────────────────────────────────────────────────────────────
requires:
  modules: [auth]

dependencies:
  feature_packs:
    - name: erp-shell-core

# ─────────────────────────────────────────────────────────────────────────────
# CONFIGURATION OPTIONS
# ─────────────────────────────────────────────────────────────────────────────
config:
  schema:
    enable_crm_company_association:
      type: boolean
      default: false
      description: "Enable associating CRM companies with projects"
    require_crm_company:
      type: boolean
      default: false
      description: "When company association is enabled, require a company to be selected for each project"

# ─────────────────────────────────────────────────────────────────────────────
# METRICS - Feature pack metric definitions
# ─────────────────────────────────────────────────────────────────────────────
metrics:
  definitions:
    - key: fp.projects.project_count
      label: Project Count
      unit: count
      icon: FolderKanban
      icon_color: "#3b82f6"
      rollup_strategy: last
      entity_kinds: [project]
      time_kind: realtime
      # Bootstrap default: allow all authenticated users to see basic project count
      default_roles_allow: [user]