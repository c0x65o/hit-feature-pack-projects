# Feature Pack: projects
# Domain-agnostic Projects feature pack - execution containers with teams, milestones, links, and activity log

name: projects
description: Projects feature pack - execution containers with teams, milestones, links, and activity log

# ─────────────────────────────────────────────────────────────────────────────
# ROUTES - Frontend page routes
# ─────────────────────────────────────────────────────────────────────────────
routes:
  - path: /projects
    page: Dashboard
    roles: []
  - path: /projects/new
    page: CreateProject
    roles: []
  - path: /projects/[id]
    page: ProjectDetail
    roles: []
  - path: /projects/[id]/edit
    page: EditProject
    roles: []
  - path: /projects/setup/statuses
    page: ProjectStatusesSetup
    roles: [admin]

# ─────────────────────────────────────────────────────────────────────────────
# NAVIGATION - Sidebar/topbar items
# ─────────────────────────────────────────────────────────────────────────────
nav:
  - id: projects
    label: Projects
    path: /projects
    icon: FolderKanban
    group: main
    weight: 100
    showWhen: authenticated
    children:
      - id: projects-dashboard
        label: Projects
        path: /projects
        icon: FolderKanban
        weight: 100
        showWhen: authenticated
      - id: projects-setup
        label: Setup
        path: ""
        icon: Settings
        weight: 900
        showWhen: authenticated
        roles: [admin]
        children:
          - id: projects-setup-statuses
            label: Statuses
            path: /projects/setup/statuses
            icon: Tag
            weight: 100
            showWhen: authenticated
            roles: [admin]

# ─────────────────────────────────────────────────────────────────────────────
# SCHEMA - Drizzle ORM table definitions
# ─────────────────────────────────────────────────────────────────────────────
schema:
  source: src/schema/projects.ts
  exports:
    - projects
    - projectStatuses
    - projectMilestones
    - projectLinks
    - projectActivity
    - projectNotes
    - Project
    - ProjectStatusRecord
    - ProjectMilestone
    - ProjectLink
    - ProjectActivity
    - ProjectNote
    - InsertProject
    - InsertProjectStatus
    - InsertProjectMilestone
    - InsertProjectLink
    - InsertProjectActivity
    - InsertProjectNote
    - DEFAULT_PROJECT_STATUS_KEYS
    - MILESTONE_STATUSES
    - ACTIVITY_TYPES
    - ProjectStatus
    - DefaultProjectStatusKey
    - MilestoneStatus
    - ActivityType

# ─────────────────────────────────────────────────────────────────────────────
# API ROUTES - Backend endpoints
# ─────────────────────────────────────────────────────────────────────────────
api:
  routes:
    # Projects
    - path: /api/projects
      methods: [GET, POST]
      handler: "@hit/feature-pack-projects/server/api/projects"
      description: "List projects (GET) or create project (POST)"
    - path: /api/projects/[projectId]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-projects/server/api/projects-id"
      description: "Get, update, or delete a specific project"
    # Project Milestones
    - path: /api/projects/[projectId]/milestones
      methods: [GET, POST]
      handler: "@hit/feature-pack-projects/server/api/projects-milestones"
      description: "List project milestones (GET) or create milestone (POST)"
    - path: /api/projects/[projectId]/milestones/[milestoneId]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-projects/server/api/projects-milestones-id"
      description: "Get, update, or delete a project milestone"
    # Project Links
    - path: /api/projects/[projectId]/links
      methods: [GET, POST]
      handler: "@hit/feature-pack-projects/server/api/projects-links"
      description: "List project links (GET) or create link (POST)"
    - path: /api/projects/[projectId]/links/[linkId]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-projects/server/api/projects-links-id"
      description: "Get, update, or remove a project link"
    # Project Activity (read-only)
    - path: /api/projects/[projectId]/activity
      methods: [GET]
      handler: "@hit/feature-pack-projects/server/api/projects-activity"
      description: "List project activity log (read-only)"
    # Project Statuses (setup-controlled)
    - path: /api/projects/statuses
      methods: [GET, POST]
      handler: "@hit/feature-pack-projects/server/api/projects-statuses"
      description: "List project statuses (GET) or create status (POST) [admin]"
    - path: /api/projects/statuses/[statusKey]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-projects/server/api/projects-statuses-key"
      description: "Get, update, or delete a project status [admin]"

# ─────────────────────────────────────────────────────────────────────────────
# DEPENDENCIES
# ─────────────────────────────────────────────────────────────────────────────
requires:
  modules: [auth]

dependencies:
  feature_packs:
    - name: dashboard-shell

# ─────────────────────────────────────────────────────────────────────────────
# CONFIGURATION OPTIONS
# ─────────────────────────────────────────────────────────────────────────────
config:
  schema:
    enable_crm_company_association:
      type: boolean
      default: false
      description: "Enable associating CRM companies with projects"
    require_crm_company:
      type: boolean
      default: false
      description: "When company association is enabled, require a company to be selected for each project"

# ─────────────────────────────────────────────────────────────────────────────
# METRICS - Feature pack metric definitions
# ─────────────────────────────────────────────────────────────────────────────
metrics:
  definitions:
    - key: fp.projects.project_count
      label: Project Count
      unit: count
      rollup_strategy: last
      entity_kinds: [project]
      time_kind: realtime
